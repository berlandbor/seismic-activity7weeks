<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ó–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è –∑–∞ –Ω–µ–¥–µ–ª—é</title>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Leaflet -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.3/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.3/dist/leaflet.js"></script>

    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        #map { height: 500px; width: 80%; margin: auto; }
        .stats { margin: 20px auto; padding: 10px; width: 80%; text-align: left; border: 1px solid #ccc; background: #f9f9f9; }
        .stats h2 { text-align: center; }
        canvas { width: 80% !important; max-width: 800px; margin: 20px auto; }
    </style>
</head>
<body>
    <h1>–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–π –∑–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é –Ω–µ–¥–µ–ª—é</h1>

    <div class="stats">
        <h2>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
        <p><b>–í—Å–µ–≥–æ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–π:</b> <span id="total">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
        <p><b>–°—Ä–µ–¥–Ω—è—è –º–∞–≥–Ω–∏—Ç—É–¥–∞:</b> <span id="average">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
        <p><b>–°–∞–º–æ–µ —Å–∏–ª—å–Ω–æ–µ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–µ:</b> <span id="max">–ó–∞–≥—Ä—É–∑–∫–∞...</span></p>
    </div>

    <canvas id="earthquakeChart"></canvas>

    <div id="map"></div>

 <footer><p>¬©berlandbor (Berlin Andrew)</p></footer>

    <script>
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞—Ç—ã 7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥
        function getPastDate(daysAgo) {
            let date = new Date();
            date.setDate(date.getDate() - daysAgo);
            return date.toISOString().split("T")[0]; // –§–æ—Ä–º–∞—Ç YYYY-MM-DD
        }

        const START_DATE = getPastDate(7); // 7 –¥–Ω–µ–π –Ω–∞–∑–∞–¥
        const END_DATE = new Date().toISOString().split("T")[0]; // –°–µ–≥–æ–¥–Ω—è

        // USGS API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏–π –∑–∞ –Ω–µ–¥–µ–ª—é
        const USGS_API_URL = `https://earthquake.usgs.gov/fdsnws/event/1/query?format=geojson&starttime=${START_DATE}&endtime=${END_DATE}`;

        let allEarthquakes = [];
        let sumMagnitude = 0;
        let maxMagnitude = 0;
        let maxPlace = "";
        let totalEarthquakes = 0;
        let dailyCounts = {};

        fetch(USGS_API_URL)
            .then(response => response.json())
            .then(data => {
                if (!data.features || data.features.length === 0) {
                    alert("–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è—Ö –∑–∞ —ç—Ç—É –Ω–µ–¥–µ–ª—é.");
                    return;
                }

                // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É
                let map = L.map('map').setView([20, 0], 2);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '¬© OpenStreetMap'
                }).addTo(map);

                data.features.forEach(eq => {
                    let coords = eq.geometry.coordinates;
                    let magnitude = eq.properties.mag;
                    let place = eq.properties.place;
                    let time = new Date(eq.properties.time);
                    let day = `${time.getFullYear()}-${String(time.getMonth() + 1).padStart(2, '0')}-${String(time.getDate()).padStart(2, '0')}`;

                    sumMagnitude += magnitude;
                    if (magnitude > maxMagnitude) {
                        maxMagnitude = magnitude;
                        maxPlace = place;
                    }

                    if (!dailyCounts[day]) dailyCounts[day] = 0;
                    dailyCounts[day]++;
                    totalEarthquakes++;

                    let color = magnitude > 5 ? 'red' : magnitude > 3 ? 'orange' : 'blue';
                    let radius = magnitude * 2;

                    L.circleMarker([coords[1], coords[0]], {
                        radius: radius,
                        color: color,
                        fillColor: color,
                        fillOpacity: 0.6
                    }).addTo(map)
                    .bindPopup(`<b>–ú–µ—Å—Ç–æ:</b> ${place}<br><b>–ú–∞–≥–Ω–∏—Ç—É–¥–∞:</b> ${magnitude}<br><b>–í—Ä–µ–º—è:</b> ${time.toLocaleString()}`);
                });

                // –í—ã–≤–æ–¥–∏–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
                document.getElementById("total").textContent = totalEarthquakes;
                document.getElementById("average").textContent = (sumMagnitude / totalEarthquakes).toFixed(2);
                document.getElementById("max").textContent = `${maxMagnitude} (${maxPlace})`;

                // –†–∏—Å—É–µ–º –≥—Ä–∞—Ñ–∏–∫
                const ctx = document.getElementById('earthquakeChart').getContext('2d');
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: Object.keys(dailyCounts),
                        datasets: [{
                            label: '–ó–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è –ø–æ –¥–Ω—è–º',
                            data: Object.values(dailyCounts),
                            backgroundColor: 'rgba(54, 162, 235, 0.5)',
                            borderColor: 'rgba(54, 162, 235, 1)',
                            borderWidth: 2,
                            fill: true
                        }]
                    },
                    options: {
                        scales: { y: { beginAtZero: true } }
                    }
                });
            })
            .catch(error => {
                console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö:", error);
                alert("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –æ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è—Ö.");
            });
    </script>
   
</body>
</html>
